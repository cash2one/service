<!DOCTYPE html>
<html lang='zh-CN'>
	<head>
		#parse('front/_pagelet/Common.IndexHeader.html')
		<link rel='stylesheet' type='text/css' media='screen' href='$!{conf.html.cdn}bootstrap/3.2.0/docs/assets/css/docs.min.css?v3.2.0' />
		<link rel='stylesheet' type='text/css' media='screen' href='$!{conf.html.external_res}assets/css/olx/olx.css?v3' />
		<style type='text/css'>
		.bs-callout {
			padding: 0 20px;
			margin: 0 0 5px;
		}
		.bs-callout h6 {
			font-weight: bold;
		}
		.zone {
			font-size: 12px;
			margin-bottom: 10px;
		}
		</style>
	</head>
	<body>
		#parse('back/_pagelet/Side.TopBanner.html')
		<header id='header'></header>
		<div class='container'>
			<div class='row'>
				<div class='col-sm-12 col-md-12'>
					#parse('front/_pagelet/Side.TopMessage.html')
				</div>
			</div>
			<div class='row'>
				<div class='col-sm-12 col-md-12'>
					<div class='panel panel-default'>
						<div class='panel-body'>
							<ol class='breadcrumb'>
								<li>
									<i class='fa fa-home fa-fw'></i>
									<a href='/'>SMS 短信</a></li>
								<li class='active'><a href='javascript:;'>发送短信</a></li>
							</ol>
							<form class='form-horizontal' id='smsFrm' role='form' onsubmit='return false;' data-url='/sendSMS'>
								<div class='form-group'>
									<label class='col-sm-12' for='smsFrm_content'>短信内容（还可以录入<span style='color:red'>70</span>个字）</label>
									<div class='col-sm-12'>
										<textarea class='form-control' rows='3' name='Content' id='smsFrm_content' placeholder='' required='required'></textarea>
									</div>
								</div>
								<div class='form-group'>
									<label class='col-sm-12' for='smsFrm_testMobile'>添加测试号（<span style='color:red'>号码之间按回车</span>）</label>
									<div class='col-sm-12'>
										<textarea class='form-control' rows='3' name='TestMobile' id='smsFrm_testMobile' placeholder='138371xxxx1'></textarea>
									</div>
								</div>
								<div class='form-group'>
									<label class='col-sm-12' for='smsFrm_smsNum'>今日您的预约发送量为<span style='color:red'>#num2Money(15000)</span>条</label>
									<div class='col-sm-12'>
										<input type='text' class='form-control' name='SmsNum' id='smsFrm_smsNum' placeholder='0' value='15000' readonly>
									</div>
								</div>
								<div class='form-group'>
									<label class='col-sm-12' for='smsFrm_zone'>选择地区</label>
									<div class='col-sm-12 fontSize'>
										<select class='form-control' id='smsFrm_zone' name='Zone'>
											#foreach($city in $data.citys)
											<option value='$!{city.id}'#if($velocityCount == 1) selected#end>$!{city.ZONE_NAME}</option>
											#end
										</select>
									</div>
								</div>
								<span id='span_zone_regions'>
								</span><!-- 选择地区 -->
								<div class='form-group'>
									<label class='col-sm-12'>号码筛选</label>
								</div>
								<span id='span_code_filter'>
								</span><!-- 号码筛选 -->
								<div class='form-group'>
									<label class='col-sm-12'>当前已选中（<span style='color:red' id='calcNum'>0</span>）个号码</label>
								</div>
								<div class='form-group'>
									<div class='col-sm-12'>
										<button id='smsFrm_btn_sub' type='button' class='btn btn-primary'>发送短信</button>
									</div>
								</div>
							</form>
						</div>
					</div>
				</div>
			</div>
		</div>
		#parse('front/_pagelet/Side.IndexFooter.html')
		#parse('front/_pagelet/Side.BackTop.html')
		#parse('front/_pagelet/Common.IndexJs.html')
		#parse('front/_pagelet/Common.LastJs.html')

		<script type='text/javascript'>
		(function(){
			var p1 = $('#smsFrm_zone').children('option:selected').val();
			changeZone(p1);
		})();

		function changeZone(p1){
			$.ajax({
				url: '/changeZone/'+ p1,
				type: 'GET',
				dataType: 'json'
			}).done(function (data){
				if(!data.success){
					if('timeout' === data.status){
						return location.reload();
					}
				}
				$('#span_zone_regions').html(data.data[0]);
				$('#span_code_filter').html(data.data[1]);
			}).complete(function(){
				// TODO
			});
		}

		$('#smsFrm_zone').change(function(){
			$('#calcNum').html(0);
			var p1 = $(this).children('option:selected').val();
			changeZone(p1);
		});

		$('#smsFrm_btn_sub').click(function(){
			$('#smsFrm').olxForm('submit', [function(){
				// TODO
			}, function (valiResu){
				// TODO
			}, function (data){
				if(!data.success){
					if('timeout' === data.status){
						return location.reload();
					}
				}
			}]);
		});

		function currencyformat(num){
			num = num || 0;
			num = num + '';
			var re = /(-?\d+)(\d{3})/;
			while(re.test(num)){
				num = num.replace(re, '$1,$2');
			}
			return num;
		}

		function calcCount(src){
			var num = parseInt($('#calcNum').html().replace(/,/gm,''));
			var n = 0;
			if(src.checked){
				n = num + parseInt(src.value);
			}else{
				n = num - src.value;
			}
			$('#calcNum').html(currencyformat(n));
		}
		</script>
	</body>
</html>